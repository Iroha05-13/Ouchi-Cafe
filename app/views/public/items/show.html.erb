<div>
  <%= link_to shop_path(@item.shop.id) do %>
    <span><%= @item.shop.name %></span>
  <% end %>
</div>

<div>
  <%= image_tag @item.get_item_image(500,300) %>
</div>

<div>
  <h3><%= @item.name %></h3>
  <h3>￥<%= @item.with_tax %></h3>
</div>

<div class="form-group">
  <%= form_with model: @cart_item, url: "/cart_items", method: :post, local: true do |f| %>
    <% if user_signed_in? %>
      <%= f.hidden_field :item_id, :value => @item.id, class: "form-control" %>
      <%= f.select :amount, *[1..10], {selected: 1}, class: "form-control-sm" %>
      <%= f.submit "カートに入れる", class: "btn btn-outline-secondary" %>
    <% else %>
      <%= f.select :amount, *[1..10], {selected: 1}, class: "form-control-sm" %>
      <%= link_to "カートに入れる", new_user_session_path, class: "btn btn-outline-secondary" %>
    <% end %>
  <% end %>
</div>

<div>
  <% if @item.favorited_by?(current_user) %>
    <h1><%= link_to "♥", item_favorites_path(@item), method: :delete %></h1>
  <% else %>
    <h1><%= link_to "♡", item_favorites_path(@item), method: :post %></h1>
  <% end %>

  <p><%= link_to "商品のレビューを書く", new_item_post_comment_path(@item), class: "btn btn-sm btn-outline-secondary" %></p>
</div>

<div>
  <p>商品レビュー</p>
  <% if @post_comments.present? %>
    <% @post_comments.each do |post_comment| %>
      <div id="star<%= post_comment.id %>">
        <script>
          $('#star<%= post_comment.id %>').raty({
            size     : 36,
            starOff:  '<%= asset_path('star-off.png') %>',
            starOn : '<%= asset_path('star-on.png') %>',
            half: false,
            readOnly: true,
            score: <%= post_comment.rate%>
          });
        </script><br>
        投稿者:<%= post_comment.name %>(<%= post_comment.created_at.strftime("%Y/%m/%d") %>)<br>
        <%= post_comment.comment %>
        <% if post_comment.user == current_user %>
          <%= link_to "削除", item_post_comment_path(post_comment.item, post_comment), method: :delete, "data-confirm" => "コメントを削除します。よろしいですか？", class: "btn btn-sm btn-outline-secondary" %>
        <% end %>
      </div>
    <% end %>
  <% else %>
    <p>こちらの商品はまだレビューがありません。</p>
  <% end %>
</div>
